# install logstash
wget -N -P /etc/yum.repos.d/ https://raw.githubusercontent.com/fromcloud/userdata/master/logstash.repo
yum -y install logstash
wget -N -P /etc/pki/tls/ https://raw.githubusercontent.com/fromcloud/userdata/master/openssl.cnf
sed -i 's/server_ip/$myip/g' /etc/pki/tls/openssl.cnf
cd /etc/pki/tls;openssl req -config /etc/pki/tls/openssl.cnf -x509 -days 3650 -batch -nodes -newkey rsa:2048 -keyout private/logstash-forwarder.key -out certs/logstash-forwarder.crt
wget -N -P /etc/logstash/conf.d/ https://raw.githubusercontent.com/fromcloud/userdata/master/01-lumberjack-input.conf
wget -N -P /etc/logstash/conf.d/ https://raw.githubusercontent.com/fromcloud/userdata/master/10-syslog.conf
wget -N -P /etc/logstash/conf.d/ https://raw.githubusercontent.com/fromcloud/userdata/master/30-lumberjack-output.conf
service logstash start
chkconfig logstash on
